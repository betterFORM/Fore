<!--<script src="../../pages/resources/js/jquery.atmosphere.js"/>-->
<!--<script src="../../bower_components/jquery-xpath/jquery.xpath.js" type="text/javascript"></script>-->

<style>
    *[required]:before {
        display: table;
        content: "*";
        color:red;
    }
</style>
<script>
    var XFInput = document.registerElement('fore-input', {
        extends: 'input',
        prototype: Object.create(HTMLInputElement.prototype, {

            createdCallback: {
                value: function () {
                    console.log("# created fore-input with id: ", this.id);
                    var fore = document.querySelector('fore-bridge');
                    var that = this;

                    $(this).on("keyup", function () {
                        if (!this.hasAttribute("readonly")) {
                            var binding = document.querySelector('#' + that.getAttribute("bind"));
                            binding.setNodeValue($(this).val());


                            /*
                                                        var msg = {
                                                            id: this.getAttribute("id"),
                                                            ref: this.getAttribute("ref"),
                                                            value: $(this).val(),
                                                            eventType: 'valueChange'
                                                        };

                                                        fore.sendMessage(msg);
                            */
                        }
                    });

                    $(window).on("refresh", function () {
                        console.log("# refresh event received ", that);

                        var binding = document.querySelector('#' + that.getAttribute("bind"));
                        //set my value
                        var myVal = binding.instanceValue;
                        $(that).val(myVal)

                        console.log("readonly?", binding.readonly);
                        that.setReadonly(binding.readonly);

                        console.log("required?", binding.required);
                        that.setRequired(binding.required);
//                        console.log("relevant?" , binding.relevant);
//                        console.log("valid?" , binding.valid);


                    });

                    $(this).on("xforms-ready", function () {
                        console.log("xforms-ready - received on id with 'on': ", this.id);
                        var ident = this.id;
                        var ref = this.getAttribute("ref");
                        console.log("id: ", ident, " ref: ", ref);
                        var msg = {
                            id: ident,
                            ref: ref,
                            eventType: 'init'
                        };
                        fore.sendMessage(msg);
                    });

                }
            },
            setValue: {
                value: function (newValue) {
                    $(this).val(newValue);
                }
            },
            setReadonly: {
                value: function (readonly) {
                    console.log("control ", this.id, " readonly: ", readonly);
                    if (readonly === true) {
                        this.setAttribute("readonly", "readonly");
                    } else {
                        this.removeAttribute("readonly");
                    }
                }
            },
            setRequired: {
                value: function (required) {
                    console.log("control ", this.id, " required: ", required);
                    if (required === true) {
                        this.setAttribute("required", "required");
                    } else {
                        this.removeAttribute("required");
                    }
                }
            },
            setRelevant: {
                value: function (relevant) {
                    console.log("control ", this.id, " relevant: ", relevant);
                }
            },
            setValid: {
                value: function (valid) {
                    console.log("control ", this.id, " valid: ", valid);
                }
            },

            refresh: {
                value: function () {

                }
            }

        })
    });


</script>
